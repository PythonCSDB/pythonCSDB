Jupyter Notebook
Broadie_with_Problems-1
(unsaved changes)
Current Kernel Logo
Python 3 
File
Edit
View
Insert
Cell
Kernel
Widgets
Help

Broadie and Kaya Capital Structure Model
import numpy as np
import matplotlib.pyplot as plt
from math import log, sqrt, exp
from scipy import stats
from scipy import optimize as sco
%matplotlib inline
We begin by modeling the dynamics of the unlevered firm under the risk neutral measure. Specifically, we have:
VT=V0e(rf−q)T−σ22T+σT√ZT
Here, the unlevered firm generates cash at the proportional rate, q. The expected value of the assets of the firm is E0[VT]=V0e(rf−q)T. Since the total expected return should grow at the riskless rate, the accrued value of the cash generated over time T is V0eqT−V0.

We approximate the dynamics with a binomial model with a time partition of width Δt. The cash produced by the firm when its value is Vt is given by Vtδt where
δ=eqΔt−1
At each node of the lattice we have the asset value and cash. We have the usual binomial model parameterization, namely:
udpδ====eσΔt√1/ue(rf−q)Δt−d(u−d)(eqΔt−1)
Then, on the lattice we have:
Vt=[p(V+t+Δt(1+δ)+(1−p)(V−t+Δt(1+δ)]e−rΔt
where V+t+Δ is the successor up node, and V−t+Δ is the successor down node.

n = 3;T=3;sigma =0.40;r=0.06;q = 0.04; V0 = 100;F = 90; FF = 90; cr = 0.05;tau = 0.25;b = 0.50 
dt = T/n; u = exp(sigma*sqrt(dt)); d = 1/u; disc = exp(-r*dt); p = (exp((r-q)*dt) - d)/(u - d); pbar = 1-p;
delta = exp(q*dt)-1
c = cr*FF*dt
n = 3
#V[j,t].....j downjumps in t periods j = 0....,t
V      = np.zeros((4,4))
cash   = np.zeros((4,4))
V[0,0] = V0
for t in range(1,4):
    V[0,t]    = u*V[0,t-1]
    cash[0,t] = V[0,t]*delta
    V[t,t]    = d*V[t-1,t-1]
    cash[t,t] = delta*V[t,t]
for t in range(2, n+1):
    for j in range(1,t):
        V[j, t] = V[j-1,t]*d**2
        cash[j,t] = V[j,t]*delta
print('Value of Assets, V \n')        
print(V)
print('')
print('Cash Generation, cash \n')
print(cash)
   
Assume a firm has issued a bond that promises to pay coupons at a total rate of C per year.
The face value of the debt is F. The effective tax rate is τ.
The government subsidy is τC per year, so the effective cost of the coupons is (1−τ)C per year.
Given the time increments of the lattice, we can compute the exact time periods where a coupon payment is scheduled and where a principal payment is scheduled. Let ct be the net payment due at time period t.
In the case where a firm had only one coupon bond outstanding, with face value F and coupon payment c, then ct would equal 0 if time increment did not correspond to a coupon date, It would equal c if the date wasa coupon date and it would equal c+F if it t was the maturity date.
The debt obligation at any time period is paid from the firms cash flow, δt at date t.
If the debt payment is smaller than the cash flow, then there is no problem. The residual is paid off as a dividend to the shareholders.
However, if the debt obligation is greater than the cash flow, then, if it is in the interest of the shareholders, they will either issue equity to cover the shortfall, or if it is not in the shareholders interest they will default.
For the moment, assume we are at a node in the lattice. The present value of the equity, ignoring the current coupon and current cash flow is given by:
Ẽ =e−rfΔt(pE++(1−p)E−)
Similarly, the present value of the debt and the present value of the unlevered firm are:
D̃ Ṽ ==e−rfΔt(pD++(1−p)D−)e−rfΔt(pV++(1−p)V−)
In computing these values we are ignoring any events that occur at the current node. Clearly, these values need to be modified based on events such as coupon payments, liquidation and distress costs.

Now suppose at this node we are trying to compute the value of the equity, Et, and that we know E+t+Δt and E−t+Δt.

Further assume the cash generated by the firm is δVt and the coupon payment is ct. Let st be the shortfall, representing the difference between the coupon payment and the cash available, st=ct−δVt.

If the shortfall, st<0, there is no problem in that the cash generated by the firm exceeds the coupon payment. However, if the shortfall is positive, st>0, then the issue is less clear. Since there is a shortfall, the firm has to raise equity, or the firm defaults. Broadie and Kaya show that at this node, the value of the equity can always be written as:
Et={0Ẽ −sif Et~<stif Et~>st
The equation says that as long as the present value of equity is higher than the shortfall, then the equityholders will find it optimal to raise cash by issuing equity, and that the value of the eqiuity will be given as above.

5.We now have all the ingredients to determine the equity, debt and financial distress costs at each node in the lattice.

At time T=nΔt we know the asset value VT and cash δVT at each node.

If VT(1+δ)>(1−τ)cT+F then the firm is in good shape:
ETDTVLT===VT(1+δ)−(1−τ)cT−FcT+FVT(1+δ)+τcT
On the other hand, if VT(1+δ)<(1−τ)cT+F then the firm is not in good shapeand
ETDTVLT===0(1−b)VT(1+δ)DT
Given these boundary conditions, we now work backwards in the lattice using risk neutral valuation. For example:

Ẽ tD̃ tṼ Lt===e−rfΔt(pE+t+Δt+(1−p)E−t+Δt)e−rfΔt(pD+t+Δt+(1−p)D−t+Δt)e−rfΔt(pVL+t+Δt+(1−p)VL−t+Δt)
Then if Ẽ t+Vtδ≥(1−τ)ct, we are in good shape, and:
EtDtVLt===Ẽ +Vtδ−(1−τ)ctD̃ t=ctṼ Lt+Vtδ+τct
On the other hand if Ẽ t+Vtδ<(1−τ)ct, we are not in good shape and:
EtDtVLt===0(1−b)Vt(1+δ)Dt
Below is a three period problem which illustrates the basic idea

# This is a three period sample program 
​
eq = np.zeros((4,4))
bond = np.zeros((4,4))
VL = np.zeros((4,4))
law = np.zeros((4,4))
tax = np.zeros((4,4))
​
for j in range(0, 4):
    if V[j,3] +cash[j,3] > (1-tau)*c + F:
        eq[j,3] = V[j,3] + cash[j,3] - ((1-tau)*c + F)
        bond[j,3] = c + F
        VL[j,3] = V[j,3] + cash[j,3] + tau*c
        law[j,3] = 0
        tax[j,3] = tau*c
    else:
        eq[j,3] = 0
        bond[j,3] = (1-b)*(V[j,3]+cash[j,3])
        VL[j,3] = bond[j,3]
        law[j,3] = b*(V[j,3] + cash[j,3])
        tax[j,3] = 0.0
        
for t in range(2, -1, -1):
    
        
    for j in range(0, t+1):
        eqtilde = disc*(p*eq[j, t+1] + pbar*eq[j+1, t+1])
        btilde = disc*(p*bond[j, t+1] + pbar*bond[j+1,t+1])
        VLtilde = disc*(p*VL[j, t+1] + pbar*VL[j+1, t+1])
        lawtilde = disc*(p*law[j, t+1]+ pbar*law[j+1, t+1])
        taxtilde = disc*(p*tax[j,t+1]+pbar*tax[j+1,t+1])
        
        if (eqtilde +cash[j,t] > ( 1-tau)*c):
            eq[j,t] = eqtilde + cash[j,t]- (1-tau)*c
            bond[j,t] = btilde + c
            VL[j,t] = VLtilde  + cash[j,t] + tau*c
            law[j,t] = lawtilde
            tax[j,t] = taxtilde + tau*c
        else:
            eq[j,t] = 0
            bond[j,t] = (1-b)*(V[j,t]+cash[j,t])
            VL[j,t] = bond[j,t]
            law[j,t] = b*(V[j,t]+cash[j,t])
            tax[j,t] = 0.0
            
        
print('Equity \n')        
print(np.round(eq,2))
print('')
print('Bond \n')
print(np.round(bond, 2))
print('')
print('Value of Levered Firm \n')
print(np.round(VL,2))
print('')
print('Value of Tax Shield \n')
print(np.round(tax,2))
print('')
print('Value of Bankruptcy Claim \n')
print(np.round(law,2))
    
x = ['Value of Levered Firm','Equity','Bond','Tax Shield','Bankruptcy Claim']
y1 = [VL[0,0], eq[0,0],bond[0,0],tax[0,0],law[0,0]]
plt.barh(x,y1, label = 'Decomposition of Claims', color = 'b')
plt.xlabel('Claim on Cash Flows')
plt.ylabel('');
We have the relationship that:
VL=Equity+Debt
We also have:
VL=VU+VTaxShield−VBankruptcyClaim
We check this...
print('Value of Equity and Debt = ', round(eq[0,0]+ bond[0,0],3))
print('Value of Unlevered firm + value of tax shield - value of bankruptcy claim =', round(V0+tax[0,0] - law[0,0],3))
error = VL[0,0] -  (V0 + tax[0,0] - law[0,0])
​
Project:
Rewrite the above program but for a general n; Run your program with
V0 = 100.0; T = 10.0; F= 0.0; q = 0.0; r= 0.06; sigma = 0.40; FF = 100; coupon = 5% nperiods = 100..... THis implies that the bond issued is an annuity paying coupons continuously at a coupon of 5% of FF, ie 5 dollars a year, or 5*dt a period. Assume b = 0.50 and tau = 0.25

Then assume a bankruptcy cost of zero, b = 0, and a tax rate of zero. Do a sensitivity analysis with coupons on the x axis and equity and bond prices on the y axis as well as the value of the levered firm.Based on the figure you generate you should have confirmed the M&M theory.

Now repeat the analysis for a tax rate of 25% and a bankruptcy cost of 90%. Plot coupons from 0 to 16 and find the optimal capital structure.

Now put FF = 100 and F = 0 and increase nperiods. PLot a graph of the price of equity against nperiods. (T is fixed at 10)

V0 = 100.0;F= 0;cr = 0.05 ;q= 0.0;FF = 100;sigma = 0.30; tau = 0.25; b = 0.50. Increase time, T from amost 0 years to 200 years and for each maturity identify the equity and plot the graph. ( you should perhaps take time increments of 25 years.

Program up the Leland Model and compute the equity value and bond value and compare your answers with a long dated annuity computed on the lattice.

Now use the Leland model to show the sensitivity of bond prices to coupons for different asset volatilities. Interpret the results.

​
